<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desaf√≠o: El Auditor</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap');

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #2c3e50; /* Fondo oscuro profesional */
            color: white;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- PANTALLAS DE OVERLAY (Inicio / Fin) --- */
        .screen-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(33, 37, 41, 0.98);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .hidden { display: none; }

        h1 { font-size: 3rem; margin: 0 0 20px 0; color: #ffda79; text-transform: uppercase; letter-spacing: 2px; }
        p { font-size: 1.2rem; line-height: 1.6; color: #ddd; max-width: 600px; margin-bottom: 40px; }
        
        .highlight { color: #4cd137; font-weight: bold; }
        .highlight-bad { color: #ff5252; font-weight: bold; }

        .btn-large {
            background: #2b579a; /* Azul Tango */
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }
        .btn-large:hover { transform: scale(1.05); background: #1e3c6b; }
        .btn-secondary { background: #555; margin-left: 10px; }

        /* --- INTERFAZ DEL JUEGO --- */
        .game-container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        /* HUD (Puntos y Tiempo) */
        .hud-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }
        .hud-item { font-size: 1.1rem; font-weight: 700; }
        .score-val { color: #ffda79; }
        .time-val { color: #ff5252; }

        /* TARJETA DEL CASO */
        .card-area {
            flex: 1;
            position: relative;
            perspective: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .card {
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            color: #333;
            overflow: hidden;
            position: relative;
            transition: transform 0.4s ease-out, opacity 0.4s;
            border: 1px solid #ccc;
        }

        .card-header {
            background: #f1f2f6;
            padding: 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .avatar { font-size: 2.5rem; }
        .user-info h3 { margin: 0; font-size: 1rem; color: #2b579a; }
        .user-info span { font-size: 0.85rem; color: #666; font-weight: 600; }

        .card-body { padding: 20px; }
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .data-label { font-size: 0.9rem; color: #888; font-weight: 600; }
        .data-value { font-size: 0.95rem; color: #333; font-weight: 700; }

        /* SELLOS (Aprobado/Rechazado) */
        .stamp {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg) scale(0);
            font-size: 3rem;
            font-weight: 900;
            border: 6px solid;
            padding: 10px 20px;
            border-radius: 10px;
            opacity: 0;
            transition: all 0.2s;
            z-index: 10;
            text-transform: uppercase;
            background: rgba(255,255,255,0.8);
        }

        /* BOTONES DE ACCION */
        .controls-area {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .action-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .action-btn:active { transform: scale(0.95); }
        
        .btn-reject { background-color: #ff5252; box-shadow: 0 4px 0 #d32f2f; }
        .btn-approve { background-color: #2ecc71; box-shadow: 0 4px 0 #218c74; }
        
        .key-hint { font-size: 0.7rem; opacity: 0.7; font-weight: normal; }

        /* FEEDBACK FLOTANTE */
        .toast {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            width: 90%;
            text-align: center;
            pointer-events: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Animaciones CSS */
        .swipe-right { transform: translateX(100%) rotate(10deg) !important; opacity: 0 !important; }
        .swipe-left { transform: translateX(-100%) rotate(-10deg) !important; opacity: 0 !important; }

    </style>
</head>
<body>

    <!-- PANTALLA INICIO -->
    <div id="startScreen" class="screen-overlay">
        <h1>¬°SOS EL AUDITOR! üïµÔ∏è‚Äç‚ôÇÔ∏è</h1>
        <p>
            Te van a llegar operaciones de usuarios de Tango.<br><br>
            Tu misi√≥n es simple:<br>
            Si ves un error de configuraci√≥n o l√≥gica: <span class="highlight-bad">RECHAZ√Å (Bot√≥n Rojo)</span>.<br>
            Si la operaci√≥n es correcta: <span class="highlight">APROB√Å (Bot√≥n Verde)</span>.
        </p>
        <p style="font-size: 0.9rem; color: #aaa;">(Ten√©s 60 segundos para sumar puntos)</p>
        <button class="btn-large" onclick="startGame()">¬°DALE, EMPEZ√Å!</button>
    </div>

    <!-- PANTALLA FIN -->
    <div id="endScreen" class="screen-overlay hidden">
        <h1 style="font-size: 4rem;">‚è±Ô∏è TIEMPO</h1>
        <p>Tu Puntaje Final: <strong id="finalScore" style="font-size: 2rem; color: #ffda79;">0</strong></p>
        <p id="finalRank" style="color:#aaa; font-style:italic;">Rango: Principiante</p>
        
        <div style="margin-top: 20px;">
            <button class="btn-large" onclick="location.reload()">JUGAR DE NUEVO</button>
            <button class="btn-large btn-secondary" onclick="window.location.href='index.html'">SALIR AL MEN√ö</button>
        </div>
    </div>

    <!-- JUEGO -->
    <div class="game-container">
        <!-- HUD -->
        <div class="hud-bar">
            <div class="hud-item">Puntos: <span id="score" class="score-val">0</span></div>
            <div class="hud-item">Tiempo: <span id="timer" class="time-val">60</span>s</div>
        </div>

        <!-- TARJETA -->
        <div class="card-area" id="cardZone">
            <!-- Aqu√≠ se inyecta la tarjeta por JS -->
        </div>

        <!-- MENSAJE FEEDBACK -->
        <div id="feedbackToast" class="toast"></div>

        <!-- BOTONES -->
        <div class="controls-area">
            <button class="action-btn btn-reject" onclick="processAction(false)">
                <span>‚ùå Rechazar</span>
                <span class="key-hint">(Tecla Z)</span>
            </button>
            <button class="action-btn btn-approve" onclick="processAction(true)">
                <span>‚úÖ Aprobar</span>
                <span class="key-hint">(Tecla M)</span>
            </button>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS DE CASOS (EN VOSEO) ---
        const cases = [
            {
                role: "Operario Dep√≥sito", avatar: "üë∑", action: "Ingreso (ENT)",
                data: { "Dep√≥sito": "01 - Central", "Valorizado": "NO", "Costo": "$ 0.00" },
                isValid: true,
                msg: "¬°Exacto! Si no es valorizado, puede entrar con costo cero."
            },
            {
                role: "Administrativo", avatar: "üë®‚Äçüíº", action: "Ajuste (AJU)",
                data: { "Dep√≥sito": "01 - Central", "Valorizado": "S√ç", "Costo": "$ 0.00" },
                isValid: false,
                msg: "¬°Error! No pod√©s valorizar a costo cero, nos arruin√°s el precio promedio (PPP)."
            },
            {
                role: "Vendedor", avatar: "ü§µ", action: "Alta Talonario",
                data: { "Uso": "Interno", "Letra": "A", "Numeraci√≥n": "Autom√°tica" },
                isValid: false,
                msg: "¬°Mal! Para uso interno se usa Letra 'X', la 'A' es fiscal."
            },
            {
                role: "Supervisor", avatar: "üïµÔ∏è‚Äç‚ôÄÔ∏è", action: "Egreso (EGR)",
                data: { "Perfil": "ROTURAS", "Fecha": "Editada (Ayer)", "Dep√≥sito": "99 - Aver√≠as" },
                isValid: false,
                msg: "¬°Ojo! El perfil 'ROTURAS' tiene la fecha bloqueada al d√≠a de hoy."
            },
            {
                role: "Jefe Compras", avatar: "üíº", action: "Ingreso (FAC)",
                data: { "Talonario": "1 (Fiscal)", "Valorizado": "S√ç", "Prov": "Samsung" },
                isValid: true,
                msg: "¬°Correcto! Factura de compra valorizada, entra stock y costo."
            },
            {
                role: "Operario", avatar: "üë∑", action: "Transferencia",
                data: { "Origen": "01 - Central", "Destino": "01 - Central", "Cant": "10" },
                isValid: false,
                msg: "¬°Cualquiera! No tiene sentido transferir del dep√≥sito 01 al mismo 01."
            },
            {
                role: "Sistemas", avatar: "üíª", action: "Perfil Nuevo",
                data: { "Carga R√°pida": "S√ç", "Edita Cantidad": "S√ç", "Defecto": "1" },
                isValid: true,
                msg: "¬°Bien! Configuraci√≥n v√°lida para usar pistola de c√≥digos de barra."
            },
            {
                role: "Log√≠stica", avatar: "üöö", action: "Transferencia",
                data: { "Origen": "01 - Central", "Destino": "(Vac√≠o)", "Cant": "50" },
                isValid: false,
                msg: "¬°Falta info! Una transferencia s√≠ o s√≠ necesita un dep√≥sito de destino."
            },
            {
                role: "Contador", avatar: "üìä", action: "Egreso (EGR)",
                data: { "Causa": "Consumo Interno", "Valorizado": "S√ç", "Asiento": "Genera" },
                isValid: true,
                msg: "¬°Perfecto! Un consumo interno se valoriza para mandarlo a p√©rdida contable."
            },
            {
                role: "Pasante", avatar: "üë∂", action: "Ingreso",
                data: { "Art√≠culo": "Servicio Limpieza", "Dep√≥sito": "01", "Cant": "1" },
                isValid: false,
                msg: "¬°Nada que ver! Los servicios no manejan stock f√≠sico."
            }
        ];

        let score = 0;
        let time = 60;
        let interval;
        let currentCase = null;
        let isProcessing = false;

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            score = 0;
            time = 60;
            updateHud();
            loadCard();
            interval = setInterval(() => {
                time--;
                updateHud();
                if(time <= 0) endGame();
            }, 1000);
        }

        function updateHud() {
            document.getElementById('score').innerText = score;
            document.getElementById('timer').innerText = time;
        }

        function loadCard() {
            const zone = document.getElementById('cardZone');
            zone.innerHTML = ''; 
            
            // Seleccionar caso al azar
            currentCase = cases[Math.floor(Math.random() * cases.length)];
            
            // Crear HTML
            const card = document.createElement('div');
            card.className = 'card';
            card.id = 'activeCard';
            
            let rows = '';
            for(const [k, v] of Object.entries(currentCase.data)) {
                rows += `<div class="data-row"><span class="data-label">${k}</span><span class="data-value">${v}</span></div>`;
            }

            card.innerHTML = `
                <div class="card-header">
                    <div class="avatar">${currentCase.avatar}</div>
                    <div class="user-info">
                        <h3>${currentCase.action}</h3>
                        <span>Usuario: ${currentCase.role}</span>
                    </div>
                </div>
                <div class="card-body">${rows}</div>
                <div id="stamp" class="stamp"></div>
            `;
            
            zone.appendChild(card);
            isProcessing = false;
        }

        function processAction(approved) {
            if(isProcessing) return;
            isProcessing = true;

            const card = document.getElementById('activeCard');
            const stamp = document.getElementById('stamp');
            const isCorrect = (approved === currentCase.isValid);

            // 1. Mostrar Sello
            if(approved) {
                stamp.innerText = "APROBADO";
                stamp.style.color = "#2ecc71";
                stamp.style.borderColor = "#2ecc71";
                card.classList.add('swipe-right');
            } else {
                stamp.innerText = "RECHAZADO";
                stamp.style.color = "#ff5252";
                stamp.style.borderColor = "#ff5252";
                card.classList.add('swipe-left');
            }
            stamp.style.opacity = 1;
            stamp.style.transform = "translate(-50%, -50%) rotate(-15deg) scale(1)";

            // 2. Calcular Puntos y Feedback
            if(isCorrect) {
                score += 100;
                showToast("‚úÖ " + currentCase.msg, true);
            } else {
                score = Math.max(0, score - 50); // No bajar de 0
                showToast("‚ùå " + currentCase.msg, false);
                // Penalidad de tiempo por error grave
                time = Math.max(0, time - 2);
            }
            updateHud();

            // 3. Siguiente carta
            setTimeout(() => {
                loadCard();
            }, 400);
        }

        function showToast(msg, success) {
            const t = document.getElementById('feedbackToast');
            t.innerText = msg;
            t.style.borderLeft = success ? "5px solid #2ecc71" : "5px solid #ff5252";
            t.style.opacity = 1;
            // Reiniciar animaci√≥n
            t.style.animation = 'none';
            t.offsetHeight; /* trigger reflow */
            t.style.animation = null; 
            
            setTimeout(() => { t.style.opacity = 0; }, 2500);
        }

        function endGame() {
            clearInterval(interval);
            document.getElementById('endScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = score;
            
            let rank = "Pasante de Dep√≥sito üßπ";
            if(score > 800) rank = "Analista Junior üìã";
            if(score > 1500) rank = "Auditor Senior üßê";
            if(score > 2500) rank = "Gerente de Sistemas üèÜ";
            
            document.getElementById('finalRank').innerText = "Rango alcanzado: " + rank;
        }

        // Atajos de teclado
        document.addEventListener('keydown', (e) => {
            if(document.getElementById('startScreen').classList.contains('hidden') && 
               document.getElementById('endScreen').classList.contains('hidden')) {
                if(e.key.toLowerCase() === 'z') processAction(false);
                if(e.key.toLowerCase() === 'm') processAction(true);
            }
        });

    </script>
</body>
</html>