<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego: El Auditor de Stock</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap');

        body {
            font-family: 'Roboto', sans-serif;
            background: #2c3e50;
            color: white;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* UI DEL JUEGO */
        .game-ui {
            width: 100%;
            max-width: 500px;
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        /* HUD SUPERIOR */
        .hud {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        .score-box span { color: #f1c40f; }
        .time-box span { color: #e74c3c; }

        /* TARJETA CENTRAL */
        .card-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        .card {
            background: white;
            color: #333;
            width: 100%;
            max-width: 350px;
            height: 420px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            padding: 25px;
            box-sizing: border-box;
            text-align: center;
            position: absolute;
            transition: transform 0.3s ease, opacity 0.3s;
            border: 5px solid #ecf0f1;
        }

        .card-header {
            background: #2b579a; /* Azul Tango */
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 14px;
            text-transform: uppercase;
        }

        .card-avatar {
            font-size: 50px;
            margin-bottom: 10px;
        }

        .card-data {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 15px;
            text-align: left;
            background: #f4f6f7;
            padding: 15px;
            border-radius: 10px;
        }

        .data-row { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        .data-label { font-weight: bold; color: #7f8c8d; font-size: 12px; }
        .data-value { font-weight: bold; color: #2c3e50; }

        .card-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg) scale(0);
            font-size: 40px;
            font-weight: 900;
            text-transform: uppercase;
            border: 5px solid;
            padding: 10px 20px;
            border-radius: 10px;
            opacity: 0;
            transition: all 0.2s;
            z-index: 100;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.5);
        }

        /* CONTROLES INFERIORES */
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .btn-action {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s, filter 0.1s;
            color: white;
            box-shadow: 0 6px 0 rgba(0,0,0,0.3);
        }
        .btn-action:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
        
        .btn-reject { background: #e74c3c; } /* Rojo */
        .btn-reject:hover { background: #c0392b; }
        
        .btn-approve { background: #27ae60; } /* Verde */
        .btn-approve:hover { background: #219150; }

        /* PANTALLAS DE INICIO / FIN */
        .screen-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        .hidden { display: none; }
        
        h1 { font-size: 40px; margin-bottom: 10px; color: #f1c40f; text-shadow: 2px 2px #000; }
        p { font-size: 18px; max-width: 600px; line-height: 1.5; margin-bottom: 30px; }
        
        .big-btn {
            background: #3498db;
            color: white;
            padding: 15px 40px;
            font-size: 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.5);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        .feedback-toast {
            position: absolute;
            bottom: 120px;
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
            max-width: 80%;
        }

        /* Animaciones de tarjeta */
        .swipe-right { transform: translateX(500px) rotate(20deg); opacity: 0; }
        .swipe-left { transform: translateX(-500px) rotate(-20deg); opacity: 0; }

    </style>
</head>
<body>

    <!-- PANTALLA INICIO -->
    <div id="startScreen" class="screen-overlay">
        <div style="font-size:60px">üïµÔ∏è‚Äç‚ôÇÔ∏è</div>
        <h1>EL AUDITOR DE TANGO</h1>
        <p>Tienes <strong>60 segundos</strong>.<br>Revisa las operaciones de los usuarios.<br>Si la configuraci√≥n o la l√≥gica es incorrecta: <strong>RECHAZA</strong>.<br>Si todo est√° bien: <strong>APRUEBA</strong>.</p>
        <button class="big-btn" onclick="startGame()">¬°COMENZAR TURNO!</button>
    </div>

    <!-- PANTALLA FIN -->
    <div id="endScreen" class="screen-overlay hidden">
        <div style="font-size:60px">üèÅ</div>
        <h1>TURNO TERMINADO</h1>
        <p>Puntaje Final: <strong id="finalScore" style="color:#f1c40f; font-size:30px">0</strong></p>
        <p id="finalRank" style="font-style: italic; color:#ccc">Rango: Principiante</p>
        <div style="display:flex; gap:20px; margin-top:20px;">
            <button class="big-btn" onclick="location.reload()">REPETIR JUEGO</button>
            <button class="big-btn" style="background:#555;" onclick="window.location.href='index.html'">VOLVER AL MEN√ö</button>
        </div>
    </div>
    </div>

    <!-- JUEGO -->
    <div class="game-ui">
        <!-- HUD -->
        <div class="hud">
            <div class="score-box">Puntos: <span id="score">0</span></div>
            <div class="time-box">Tiempo: <span id="timer">60</span></div>
        </div>

        <!-- ZONA DE TARJETAS -->
        <div class="card-container" id="cardZone">
            <!-- La tarjeta se inyecta con JS -->
        </div>

        <div class="feedback-toast" id="feedback"></div>

        <!-- CONTROLES -->
        <div class="controls">
            <button class="btn-action btn-reject" onclick="handleAction(false)">‚ùå RECHAZAR (Z)</button>
            <button class="btn-action btn-approve" onclick="handleAction(true)">‚úÖ APROBAR (M)</button>
        </div>
    </div>

    <script>
        /* --- BASE DE DATOS DE CASOS --- 
           isValid: true (Aprobar), false (Rechazar)
           reason: Explicaci√≥n breve del error o acierto
        */
        const cases = [
            {
                user: "Operario Dep√≥sito",
                avatar: "üë∑",
                type: "Ingreso (ENT)",
                data: { "Dep√≥sito": "01 - Central", "Valorizado": "NO", "Costo": "$ 0.00" },
                isValid: true,
                reason: "Correcto. Un ingreso no valorizado puede tener costo cero."
            },
            {
                user: "Administrativo",
                avatar: "üë®‚Äçüíº",
                type: "Ajuste (AJU)",
                data: { "Dep√≥sito": "01 - Central", "Valorizado": "S√ç", "Costo": "$ 0.00" },
                isValid: false,
                reason: "¬°Error! No se debe valorizar a costo cero, arruina el Precio Promedio (PPP)."
            },
            {
                user: "Vendedor",
                avatar: "üßë‚Äçüíº",
                type: "Talonario Alta",
                data: { "Uso": "Interno", "Letra": "A", "Numeraci√≥n": "Auto" },
                isValid: false,
                reason: "¬°Error! Para uso interno se debe usar letra X, no letra A (Fiscal)."
            },
            {
                user: "Supervisor",
                avatar: "üë©‚Äçüíª",
                type: "Egreso (EGR)",
                data: { "Perfil": "ROTURAS", "Fecha": "Editada (Ayer)", "Dep√≥sito": "99 - Aver√≠as" },
                isValid: false,
                reason: "¬°Error! El perfil 'Roturas' tiene configurada la fecha como 'Fija/Actual' (no editable)."
            },
            {
                user: "Jefe Compras",
                avatar: "ü§µ",
                type: "Ingreso (FAC)",
                data: { "Talonario": "1 (Fiscal)", "Valorizado": "S√ç", "Prov": "Samsung" },
                isValid: true,
                reason: "Correcto. Factura de compra valorizada ingresando stock."
            },
            {
                user: "Operario",
                avatar: "üë∑",
                type: "Transferencia",
                data: { "Origen": "01", "Destino": "01", "Cant": "10" },
                isValid: false,
                reason: "¬°Il√≥gico! No se puede transferir del dep√≥sito 01 al mismo dep√≥sito 01."
            },
            {
                user: "Sistemas",
                avatar: "ü§ñ",
                type: "Perfil Nuevo",
                data: { "Carga R√°pida": "S√ç", "Edita Cantidad": "S√ç", "Defecto": "1" },
                isValid: true,
                reason: "Configuraci√≥n v√°lida para uso de pistola de c√≥digos de barras."
            },
            {
                user: "Log√≠stica",
                avatar: "üöö",
                type: "Transferencia",
                data: { "Origen": "01", "Destino": "(Vac√≠o)", "Cant": "50" },
                isValid: false,
                reason: "¬°Error! Una transferencia requiere obligatoriamente un dep√≥sito de destino."
            },
            {
                user: "Contador",
                avatar: "üìà",
                type: "Egreso (EGR)",
                data: { "Causa": "Consumo", "Valorizado": "S√ç", "Asiento": "Generado" },
                isValid: true,
                reason: "Correcto. Un egreso por consumo interno puede valorizarse y generar asiento de p√©rdida."
            },
            {
                user: "Operario",
                avatar: "üë∑",
                type: "Ingreso",
                data: { "Art√≠culo": "Servicio de Limpieza", "Dep√≥sito": "01", "Cant": "1" },
                isValid: false,
                reason: "¬°Error! Los servicios no llevan stock, no se ingresan por movimientos de stock."
            }
        ];

        let score = 0;
        let timeLeft = 60;
        let gameInterval;
        let currentCard = null;

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            score = 0;
            timeLeft = 60;
            updateUI();
            gameInterval = setInterval(gameLoop, 1000);
            nextCard();
        }

        function gameLoop() {
            timeLeft--;
            updateUI();
            if(timeLeft <= 0) {
                endGame();
            }
        }

        function updateUI() {
            document.getElementById('score').innerText = score;
            document.getElementById('timer').innerText = timeLeft;
        }

        function nextCard() {
            const zone = document.getElementById('cardZone');
            zone.innerHTML = ''; // Limpiar

            // Elegir caso random
            const caseData = cases[Math.floor(Math.random() * cases.length)];
            currentCard = caseData; // Guardar referencia actual

            // Construir HTML de la tarjeta
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            
            let rowsHtml = '';
            for (const [key, value] of Object.entries(caseData.data)) {
                rowsHtml += `
                    <div class="data-row">
                        <span class="data-label">${key}</span>
                        <span class="data-value">${value}</span>
                    </div>
                `;
            }

            cardDiv.innerHTML = `
                <div class="card-header">${caseData.type}</div>
                <div class="card-avatar">${caseData.avatar}</div>
                <div style="font-weight:bold; margin-bottom:10px; color:#555">${caseData.user}</div>
                <div class="card-data">
                    ${rowsHtml}
                </div>
                <div class="card-stamp" id="stamp"></div>
            `;

            zone.appendChild(cardDiv);
        }

        function handleAction(approved) {
            if(!currentCard) return;
            
            const cardEl = document.querySelector('.card');
            const stamp = document.getElementById('stamp');
            const isCorrect = (approved === currentCard.isValid);

            // 1. Mostrar sello visual
            if(approved) {
                stamp.innerText = "APROBADO";
                stamp.style.color = "#27ae60";
                stamp.style.borderColor = "#27ae60";
                cardEl.classList.add('swipe-right');
            } else {
                stamp.innerText = "RECHAZADO";
                stamp.style.color = "#e74c3c";
                stamp.style.borderColor = "#e74c3c";
                cardEl.classList.add('swipe-left');
            }
            
            stamp.style.transform = "translate(-50%, -50%) rotate(-15deg) scale(1)";
            stamp.style.opacity = "1";

            // 2. Calcular puntaje
            if(isCorrect) {
                score += 100;
                showToast("¬°Bien hecho! " + currentCard.reason, true);
                // A√±adir tiempo extra por buenas respuestas (opcional)
                // timeLeft += 2; 
            } else {
                score = Math.max(0, score - 50);
                showToast("¬°Mal! " + currentCard.reason, false);
                // Visual shake effect en UI principal podr√≠a ir aqu√≠
            }
            updateUI();

            // 3. Siguiente tarjeta (con peque√±o delay para animaci√≥n)
            setTimeout(() => {
                nextCard();
            }, 300);
        }

        function showToast(msg, success) {
            const t = document.getElementById('feedback');
            t.innerText = msg;
            t.style.borderLeft = success ? "5px solid #27ae60" : "5px solid #e74c3c";
            t.style.opacity = 1;
            setTimeout(() => { t.style.opacity = 0; }, 2000);
        }

        function endGame() {
            clearInterval(gameInterval);
            document.getElementById('endScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = score;
            
            let rank = "Pasante de Dep√≥sito üì¶";
            if(score > 500) rank = "Operador Junior üìã";
            if(score > 1000) rank = "Analista Senior üìà";
            if(score > 2000) rank = "Auditor Experto (Leyenda) üèÜ";
            
            document.getElementById('finalRank').innerText = "Rango alcanzado: " + rank;
        }

        // Soporte teclado
        document.addEventListener('keydown', (e) => {
            if(document.getElementById('startScreen').classList.contains('hidden') && 
               document.getElementById('endScreen').classList.contains('hidden')) {
                if(e.key === 'z' || e.key === 'Z') handleAction(false);
                if(e.key === 'm' || e.key === 'M') handleAction(true);
            }
        });

    </script>
</body>
</html>